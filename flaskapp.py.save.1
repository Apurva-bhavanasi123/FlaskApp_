from flask import *
import sqlite3
app = Flask(__name__)

def get_db_connection():
    conn = sqlite3.connect('/var/www/html/flaskapp/users.db')
    conn.row_factory = sqlite3.Row
    return conn

#print([x['fname'] for x in posts])
@app.route('/',methods=['GET','POST'])
def hello_world():
    if(request.method=='GET'):
        return  render_template('index.html')
    else:
        print("here",request.form)
        if('signup' in request.form):
            fname=request.form["fname"]
            lname=request.form["lname"]
            username=request.form["username"]
            password=request.form["password"]
            email=request.form["email"]
            try:
                with sqlite3.connect('/var/www/html/flaskapp/users.db') as conn:
                    #conn = get_db_connection()
                    cur=conn.cursor()
                    cur.execute("""INSERT INTO users (lname,fname,email,password,username) VALUES (?,?,?,?,?)""",(lname,fname,email,password,username))
                    conn.commit()
            except:
                conn.rollback()
                print("error while inserting")
            finally:
                conn.close()from flask import *
import sqlite3
app = Flask(__name__)

def get_db_connection():
    conn = sqlite3.connect('/var/www/html/flaskapp/users.db')
    conn.row_factory = sqlite3.Row
    return conn

#print([x['fname'] for x in posts])
@app.route('/',methods=['GET','POST'])
def hello_world():
    if(request.method=='GET'):
        return  render_template('index.html')
    else:
        print("here",request.form)
        if('signup' in request.form):
            fname=request.form["fname"]
            lname=request.form["lname"]
            username=request.form["username"]
            password=request.form["passsword"]
            email=request.form["email"]
            try:
                with sqlite3.connect('/var/www/html/flaskapp/users.db') as conn:
                    conn = get_db_connection()
                    cur=conn.cursor()
                    cur.execute("""INSERT INTO users (lname,fname,email,password,username) VALUES (?,?,?,?,?)""",(lname,fname,email,passwo,username))
                    conn.commit()
            except:
                conn.rollback()
                print("error while inserting")
            finally:
                conn.close()
                
        elif('login' in request.form):
            print('in signup')

        conn = get_db_connection()
        posts = conn.execute('SELECT * FROM users').fetchall()
        #conn.close()
        resp=[]
        for i in posts:
            k={}
            k['userid']=i['userid']
            k['username']=i['username']
            k['password']=i['password']
            k['fname']=i['fname']
            k['lname']=i['lname']
            k['email']=i['email']
            resp.append(k)
        print(resp)
        conn.close()
#print(posts)
        #app.logger.info(request.form.get['Uname'])
        return render_template('submit.html',result=resp)

@app.route('/countme/<input_str>')
def count_me(input_str):
    return str(len(input_str))

if __name__ == '__main__':
  app.run()
 
        elif('login' in request.form):
            print('in signup')

        conn = get_db_connection()
        posts = conn.execute('SELECT * FROM users').fetchall()
        #conn.close()
        resp=[]
        for i in posts:
            k={}
            k['userid']=i['userid']
            k['username']=i['username']
            k['password']=i['password']
            k['fname']=i['fname']
            k['lname']=i['lname']
            k['email']=i['email']
            resp.append(k)
        print(resp)
        conn.close()
#print(posts)
        #app.logger.info(request.form.get['Uname'])
        return render_template('submit.html',result=resp)

@app.route('/countme/<input_str>')
def count_me(input_str):
    return str(len(input_str))

if __name__ == '__main__':
  app.run()
